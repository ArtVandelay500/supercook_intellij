<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--  전체 매퍼 중 유일한 값을 사용하여야 한다.
 해서 관계적으로 해당 파일의 path와 file_name(확장자 제외)
 그리고 dao 에서 namespace와 일치하여야 된다. -->

<mapper namespace="Recipe">
    <sql id="selectField">
        seq,
        recipeName,
        recipeTitle,
        recipeUrl,
        recipeImg,
        recipeRating,
        recipePrepTime,
        recipeView,
        recipeSource,
        useNy
    </sql>
    <sql id="selectCommon">
        FROM
            recipe
        WHERE 1+1
        <if test="shKey != null and !shKey.equals('')">
            AND (recipeName LIKE CONCAT('%',#{shKey},'%')
            OR recipeTitle LIKE CONCAT('%',#{shKey},'%'))
        </if>
    </sql>

    <!--PAGING TOTAL COUNT-->
    <!--PAGING TOTAL COUNT-->
    <select id="selectOneCount" resultType="Integer">
        SELECT count(*)
        <include refid="selectCommon" />
    </select>
    <!--PAGING TOTAL COUNT-->
    <!--PAGING TOTAL COUNT-->

    <!--PAGING SELECT QUERY-->
    <!--PAGING SELECT QUERY-->

    <select id="selectList" resultType="recipe">

        SELECT aa.* FROM (
            SELECT
                <include refid="selectField" />
                <include refid="selectCommon" />
            ) AS aa
        LIMIT #{rowNumToShow} OFFSET #{startRnumForMysql}
    </select>

    <!--PAGING SELECT QUERY-->
    <!--PAGING SELECT QUERY-->


    <select id="selectOne" resultType="recipe">
        SELECT
            <include refid="selectField"/>
        FROM
            recipe
        WHERE seq = #{seq}
    </select>


    <update id="update">
        UPDATE recipe
        SET
            recipeName = #{recipeName},
            recipeTitle = #{recipeTitle},
            recipeUrl = #{recipeUrl},
            recipeImg = #{recipeImg},
            recipeRating = #{recipeRating},
            recipePrepTime = #{recipePrepTime},
            recipeView = #{recipeView},
            recipeSource = #{recipeSource},
            useNy = #{useNy}
        WHERE
            seq = #{seq}
    </update>


    <insert id="insert">
        INSERT INTO recipe (
            recipeName,
            recipeTitle,
            recipeUrl,
            recipeImg,
            recipePrepTime,
            recipeSource,
            useNy
            )
        VALUES(
            #{recipeName},
            #{recipeTitle},
            #{recipeUrl},
            #{recipeImg},
            #{recipePrepTime},
            #{recipeSource},
            '1'
            )
    </insert>


    <delete id="delete">
        DELETE FROM recipe WHERE seq = #{seq}
    </delete>


</mapper>